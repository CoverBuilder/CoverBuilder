/*--------------------------------------------	CB_Update_Barcodebox_Logos.jsx       (A CoverBuilder Helper Script)	An InDesign CS6 Javascript      	 (Tested in CS6)	Version 1.0		Bruno Herfst 2014        This scipts toggles the publisher logo on the barcode for Penguin Books --------------------------------------------*/#target InDesign;var document    = app.documents.item(0);var myPageItems = toArray(document.allPageItems);var logoWidth = 9.1;    //mmvar bigBox    = 45.474; //mmvar smallBox  = bigBox-logoWidth; //mmvar logoList = ["No publisher logo", "Penguin", "Puffin"];var divider       = selectWhere("Barcode_Logo_Devider", "label", myPageItems);var BarcodeBox_STD = selectWhere("BarcodeBox_STD", "label", myPageItems);var FSC_ToplogoList    = selectWhere("BarcodeLogo_FSC_Top",    "label", myPageItems);var FSC_BottomlogoList = selectWhere("BarcodeLogo_FSC_Bottom", "label", myPageItems);var FSC = FSC_ToplogoList.concat(FSC_BottomlogoList);var PUB_Penguin        = selectWhere("BarcodeLogo_Penguin",    "label", myPageItems);var PUB_Puffin         = selectWhere("BarcodeLogo_Puffin",     "label", myPageItems);var PUB = 0;var allLogos = FSC.concat(PUB_Penguin,PUB_Puffin,divider);var VisPenguin = isVissible(PUB_Penguin);var VisPuffin  = isVissible(PUB_Puffin);if(VisPenguin){	PUB = 1;} else if(VisPuffin){	PUB = 2;}// Make the dialog boxvar the_dialog = app.dialogs.add({name:"Change barcode logos"});with(the_dialog.dialogColumns.add()){	with(dialogRows.add()){		var chooseLogo = dropdowns.add({stringList:logoList, selectedIndex:PUB});	}	with(dialogRows.add()){		var FSCLogo = checkboxControls.add({staticLabel:"FSC", checkedState:isVissible(FSC)});	}}if(the_dialog.show() == true){	// Force clean start	hideItems(allLogos);	resizeItems(BarcodeBox_STD, bigBox, AnchorPoint.BOTTOM_RIGHT_ANCHOR);		switch(chooseLogo.selectedIndex){		case 1:			logoName = "BarcodeLogo_Penguin";			myColorAdd(document, "Barcode_Logo_Fill", ColorModel.PROCESS, [0, 60, 80, 0]);			break;		case 2:			logoName = "BarcodeLogo_Puffin";			myColorAdd(document, "Barcode_Logo_Fill", ColorModel.PROCESS, [0, 10, 100, 0]);			break;		default:			logoName = null;	}		if(logoName != null){		var publogos = selectWhere(logoName, "label", myPageItems);		showItems(publogos);	}	if(FSCLogo.checkedState){		// Place FSC logo		if(logoName != null){			showItems(FSC_ToplogoList);		} else {			showItems(FSC_BottomlogoList);		}	}	if(FSCLogo.checkedState || logoName != null){		showItems(divider);	} else {		resizeItems(BarcodeBox_STD, smallBox, AnchorPoint.BOTTOM_RIGHT_ANCHOR);	}} else {	the_dialog.destroy();	exit;}function selectWhere(value, key, array){    var i = array.length; var t; var filtered = [];    while(i--){    	t = array[i];		if(t && t[key] == value){			filtered.push(t);		}    }    return filtered;}function toArray(objects){    var i = objects.length; var array = [];    while(i--){            array.push(objects[i]);    }    return array;}function myColorAdd(myDocument, myColorName, myColorModel, myColorValue) {    if (myColorValue instanceof Array == false) {        myColorValue = [(parseInt(myColorValue, 16) >> 16) & 0xff, (parseInt(myColorValue, 16) >> 8) & 0xff, parseInt(myColorValue, 16) & 0xff];        myColorSpace = ColorSpace.RGB;    } else {        if (myColorValue.length == 3)            myColorSpace = ColorSpace.RGB;        else            myColorSpace = ColorSpace.CMYK;    }    try {        myColor = myDocument.colors.item(myColorName);        myName = myColor.name;    } catch (myError) {        myColor = myDocument.colors.add();    }    myColor.properties = {            name: myColorName,            model: myColorModel,            space: myColorSpace,            colorValue: myColorValue        };    return myColor;}// Functions for singular itemsfunction resizeItem(item, width, anchorpt){	/*	anchorpt:		AnchorPoint.BOTTOM_CENTER_ANCHOR		AnchorPoint.BOTTOM_LEFT_ANCHOR		AnchorPoint.BOTTOM_RIGHT_ANCHOR		AnchorPoint.CENTER_ANCHOR		AnchorPoint.LEFT_CENTER_ANCHOR		AnchorPoint.RIGHT_CENTER_ANCHOR		AnchorPoint.TOP_CENTER_ANCHOR		AnchorPoint.TOP_LEFT_ANCHOR		AnchorPoint.TOP_RIGHT_ANCHOR	*/	app.activeWindow.transformReferencePoint = anchorpt;	// [TopLeftY,TopLeftX,BottomRightY,BottomRightX,]	var gb   = item.geometricBounds;	var curW = gb[3]-gb[1];	var difference = curW - width;	item.geometricBounds = [gb[0],gb[1]+difference,gb[2],gb[3]];}function showItem(item){	item.transparencySettings.blendingSettings.opacity = 100;}function hideItem(item){	item.transparencySettings.blendingSettings.opacity = 0;}function itemShown(item){	// Checks if an item is visible	if(item.transparencySettings.blendingSettings.opacity > 0){		return true;	} else {		return false;	}}// Functions for filtered arraysfunction isVissible(filtered){	var i = filtered.length;	while(i--){		if(itemShown(filtered[i])){			return true;		}	}	return false;}function resizeItems(filtered, width, anchorpt){	var i = filtered.length;	while(i--){		resizeItem(filtered[i], width, anchorpt);	}}function showItems(filtered){	var i = filtered.length;	while(i--){		showItem(filtered[i]);	}}function hideItems(filtered){	var i = filtered.length;	while(i--){		hideItem(filtered[i]);	}}